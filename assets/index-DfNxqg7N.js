(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();function l(r){return r*29.5735}function y(r,s){const n=(r??"").toLowerCase();switch(!0){case n.includes("pint"):case n.includes("cask"):case n.includes("nitro"):return l(16);case n.includes("draft"):return s&&s>7?l(12):l(16);case n.includes("can"):case n.includes("bottle"):case n.includes("glass"):return s&&s>7?l(16):l(12);case n.includes("flight"):case n.includes("sample"):return l(5);default:return l(12)}}function E(r,s){if(r==null)return null;const n=Number(r);if(Number.isNaN(n))return null;const e=s*(n/100)*.789/14;return Number(e.toFixed(3))}function b(r){const s=["date,standard_drinks"];let n=0,t=0;for(const e of r){const o=e.beer_abv?Number(e.beer_abv):void 0,i=y(e.serving_type,o),c=E(e.beer_abv,i);if(c===null){t++;continue}const a=e.created_at?new Date(String(e.created_at)).toISOString():new Date().toISOString();s.push(`${a},${c}`),n++}return{csv:s.join(`
`),total:r.length,processed:n,skipped:t}}function L(r,s="untappd_health_data.csv"){const n=r.split(`
`),t=500;if(n.length<=t+1){m(r,s);return}const e=n[0],o=n.slice(1),i=Math.ceil(o.length/t);for(let c=0;c<i;c++){const a=c*t,u=Math.min((c+1)*t,o.length),h=[e,...o.slice(a,u)].join(`
`),v=`${s.replace(".csv","")}_part${c+1}_of_${i}.csv`;setTimeout(()=>{m(h,v)},c*100)}}function m(r,s){const n=new Blob([r],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),e=URL.createObjectURL(n);t.setAttribute("href",e),t.setAttribute("download",s),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e)}function d(r){const s=document.getElementById("error");s&&(s.textContent=r,s.classList.add("visible"))}function g(){const r=document.getElementById("error");r&&r.classList.remove("visible")}function S(r,s,n){const t=document.getElementById("totalCheckins"),e=document.getElementById("processedCount"),o=document.getElementById("skippedCount"),i=document.getElementById("stats"),c=document.getElementById("shortcutCallout"),a=document.querySelector(".callout-subtitle");t&&(t.textContent=String(r)),e&&(e.textContent=String(s)),o&&(o.textContent=String(n)),i&&i.classList.add("visible"),c&&c.classList.add("visible");const u=500;if(s>u&&a){const f=Math.ceil(s/u);a.textContent=`Your data has been split into ${f} CSV files to prevent memory issues. Import each file separately using the Shortcuts app.`}}function I(){g();const s=document.getElementById("jsonInput")?.value.trim();if(!s){d("Please upload a file or paste JSON data");return}try{const n=JSON.parse(s);if(!Array.isArray(n)){d("JSON data must be an array of checkins");return}const t=b(n);S(t.total,t.processed,t.skipped),L(t.csv)}catch(n){const t=n instanceof Error?n.message:String(n);d(`Error: ${t}`)}}function p(r){if(!r.name.endsWith(".json")){d("Please upload a JSON file");return}const s=new FileReader;s.onload=n=>{const t=document.getElementById("jsonInput");t&&n.target?.result&&(t.value=n.target.result,g())},s.onerror=()=>{d("Error reading file")},s.readAsText(r)}function C(){const r=document.getElementById("uploadArea"),s=document.getElementById("fileInput"),n=document.getElementById("convertBtn");r?.addEventListener("click",()=>s?.click()),r?.addEventListener("dragover",t=>{t.preventDefault(),r.classList.add("dragover")}),r?.addEventListener("dragleave",()=>{r.classList.remove("dragover")}),r?.addEventListener("drop",t=>{t.preventDefault(),r.classList.remove("dragover");const e=t.dataTransfer?.files;e&&e.length>0&&p(e[0])}),s?.addEventListener("change",t=>{const e=t.target;e.files&&e.files.length>0&&p(e.files[0])}),n?.addEventListener("click",I)}C();
